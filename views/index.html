<!DOCTYPE html>

<html>

<head>
        <meta charset="utf-8">

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
                integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk"
                crossorigin="anonymous">


</head>


<style>
        .node {
                cursor: pointer;
        }

        .node circle {
                fill: #fff;
                stroke: rgb(64, 151, 221);
                stroke-width: 1.5px;
        }

        .node text {
                font: 13px sans-serif;
        }

        .link {
                fill: none;
                stroke: #ccc;
                stroke-width: 1.5px;
        }

        .link text {
                font: 13px sans-serif;
        }

        table,
        th,
        td {
                border: 1px solid white;
                border-collapse: collapse;
        }

        th,
        td {
                background-color: #96D4D4;
        }
</style>

<body>
        <div >
                <div class="row">
                        <br/>
                        <div class="col col-md-3">
                                <h2>D3 Decision tree demo</h1>
                        </div>
                        <div class="col col-md-2">
                                <button id="show" onClick="showDecisionTree()" class="btn btn-md btn-primary">Show
                                        tree</button>
                        </div>

                </div>
                <br/>
                <div>
                        <div class="row">
                                <div id="tableDiv" class="col col-md-3">

                                </div> 
                                <div id="svgDiv" class="col col-md-7">

                                </div> 
                        
                        </div>
                
                </div>
        </div>

        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
                integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
                crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
                integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
                crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>


        <script>

                var data = {
                        "name": "Outlook -> Rainy|Overcast|Sunny",
                        "children": [
                                {
                                        "name": "Windy -> True|False",
                                        "rule": "Rainy",
                                        "children": [
                                                {
                                                        "name": "NO",
                                                        "rule": "True"
                                                },
                                                {
                                                        "name": "YES",
                                                        "rule": "False"
                                                }
                                        ]
                                },
                                {
                                        "name": "YES",
                                        "rule": "Overcast"
                                },
                                {
                                        "name": "Humidity -> Normal|High",
                                        "rule": "Sunny",
                                        "children": [
                                                {
                                                        "name": "YES",
                                                        "rule": "Normal"
                                                },
                                                {
                                                        "name": "NO",
                                                        "rule": "High"
                                                }
                                        ]
                                }
                        ]
                }

                //create table
                var weather_array = [
                        ['outlook', 'temp', 'humidity', 'windy', 'play'],
                        ["sunny", "hot", "high", "false", "no"],
                        ["sunny", "hot", "high", "true", "no"],
                        ["overcast", "hot", "high", "false", "yes"],
                        ["rainy", "mild", "high", "false", "yes"],
                        ["rainy", "cool", "normal", "false", "yes"],
                        ["rainy", "cool", "normal", "true", "no"],
                        ["overcast", "cool", "normal", "true", "yes"],
                        ["sunny", "mild", "high", "false", "no"],
                        ["sunny", "cool", "normal", "false", "yes"],
                        ["rainy", "mild", "normal", "false", "yes"],
                        ["sunny", "mild", "normal", "true", "yes"],
                        ["overcast", "mild", "high", "true", "yes"],
                        ["overcast", "hot", "normal", "false", "yes"],
                        ["overcast", "hot", "normal", "false", "yes"]
                ];


                var table = document.createElement('table');
                table.setAttribute("class", "table table-striped");
                table.setAttribute("width", "200px")
                table.setAttribute("border", " 1px solid white");
                table.setAttribute("border-collapse", "collapse");
                table.setAttribute("background-color", "#96D4D4");
                document.getElementById("tableDiv").appendChild(table) // Drew the main table node on the document

                for (var i = 0; i < 15; i++) {
                        if (i === 0) {
                                var thead = document.createElement('thead'); //Create 3 <tr> elements assigned to a unique variable BUT need a working alternative for 'tr[i]'
                                thead.setAttribute("id", "thead")
                                table.appendChild(thead); // Append to <table> node
                        }
                        else {
                                var tr = document.createElement('tr'); //Create 3 <tr> elements assigned to a unique variable BUT need a working alternative for 'tr[i]'
                                table.appendChild(tr); // Append to <table> node
                        }

                        for (var j = 0; j < 5; j++) {
                                if (i === 0) {
                                        var tdElement = document.createElement('th');
                                        tdElement.innerHTML = weather_array[i][j];
                                        document.getElementById("thead").appendChild(tdElement);
                                }
                                else {
                                        var tdElement = document.createElement('td');
                                        tdElement.innerHTML = weather_array[i][j];
                                        tr.appendChild(tdElement); // Take string from placeholder variable and append it to <tr> node
                                }

                        }
                }



                //load data from file
                function loadData() {
                        var file = document.getElementById('myfile').files[0];
                        var reader = new FileReader();
                        reader.readAsText(file, 'UTF-8');
                        reader.onload = function (evt) {
                                document.getElementById('content').innerHTML = evt.target.result;
                                return JSON.parse(evt.target.result);
                        }
                }

                function showDecisionTree() {
                        var margin = { top: 20, right: 120, bottom: 20, left: 250 },
                                width = 1000 - margin.right - margin.left,
                                height = 650 - margin.top - margin.bottom;

                        var i = 0,
                                duration = 750,
                                root;
                        var tree = d3.layout.tree().size([height, width]);

                        var diagonal = d3.svg.diagonal().projection(function (d) { return [d.y, d.x]; });

                        var svg = d3.select("#svgDiv").append("svg")
                                .attr("width", width + margin.right + margin.left)
                                .attr("height", height + margin.top + margin.bottom)
                                .append("g")
                                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

                        // var data = loadData().then(console.log(data));
                        console.log("data: ");

                        root = data;
                        root.x0 = height / 2;
                        root.y0 = 0;

                        function collapse(d) {
                                if (d.children) {
                                        d._children = d.children;
                                        d._children.forEach(collapse);
                                        d.children = null;
                                }
                        }

                        root.children.forEach(collapse);
                        update(root);


                        d3.select(self.frameElement).style("height", "650px");

                        function update(source) {

                                //Compute the new tree layout.
                                var nodes = tree.nodes(root).reverse();
                                var links = tree.links(nodes);
                                console.log(links)

                                // Normalize for fixed-depth.
                                nodes.forEach(function (d) { d.y = d.depth * 180; });

                                // Update the nodes…
                                var node = svg.selectAll("g.node")
                                        .data(nodes, function (d) { return d.id || (d.id = ++i); });

                                // Enter any new nodes at the parent's previous position.
                                var nodeEnter = node.enter().append("g")
                                        .attr("class", "node")
                                        .attr("transform", function (d) { return "translate(" + source.y0 + "," + source.x0 + ")"; })
                                        .on("click", click);

                                nodeEnter.append("circle")
                                        .attr("r", 1e-6)
                                        .style("fill", function (d) { return d._children ? "lightsteelblue" : "#fff"; });

                                nodeEnter.append("text")
                                        .attr("x", function (d) { return d.children || d._children ? -10 : 10; })
                                        .attr("dy", ".35em")
                                        .attr("text-anchor", function (d) { return d.children || d._children ? "end" : "start"; })
                                        .text(function (d) { return d.name; })
                                        .style("fill-opacity", 1e-6);

                                // Transition nodes to their new position.
                                var nodeUpdate = node.transition()
                                        .duration(duration)
                                        .attr("transform", function (d) { return "translate(" + d.y + "," + d.x + ")"; });

                                nodeUpdate.select("circle")
                                        .attr("r", 8)
                                        .style("fill", function (d) { return d._children ? "lightsteelblue" : "#fff"; });

                                nodeUpdate.select("text")
                                        .style("fill-opacity", 1);


                                // Transition exiting nodes to the parent's new position.
                                var nodeExit = node.exit().transition()
                                        .duration(duration)
                                        .attr("transform", function (d) { return "translate(" + source.y + "," + source.x + ")"; })
                                        .remove();

                                nodeExit.select("circle")
                                        .attr("r", 1e-6);

                                nodeExit.select("text")
                                        .style("fill-opacity", 1e-6);

                                // Update the links…
                                var link = svg.selectAll("path.link")
                                        .data(links, function (d) { return d.target.id; });

                                // Enter any new links at the parent's previous position.
                                link.enter().insert("path", "g")
                                        .attr("class", "link")
                                        .attr("d", function (d) {
                                                var o = { x: source.x0, y: source.y0 };
                                                return diagonal({ source: o, target: o });
                                        });

                                // Transition links to their new position.
                                link.transition()
                                        .duration(duration)
                                        .attr("d", diagonal);

                                // Transition exiting nodes to the parent's new position.
                                link.exit().transition()
                                        .duration(duration)
                                        .attr("d", function (d) {
                                                var o = { x: source.x, y: source.y };
                                                return diagonal({ source: o, target: o });
                                        })
                                        .remove();


                                //set text on links
                                link.append("text")
                                        .attr("font-family", "Arial, Helvetica, sans-serif")
                                        .attr("fill", "Black")
                                        .style("font", "normal 12px Arial")
                                        .attr("text-anchor", "middle")
                                        .text(function (d) {
                                                console.log(d.target.rule);
                                                return d.target.rule;
                                        });


                                // Stash the old positions for transition.
                                nodes.forEach(function (d) {
                                        d.x0 = d.x;
                                        d.y0 = d.y;
                                });

                        }


                        // Toggle children on click.
                        function click(d) {
                                if (d.children) {
                                        d._children = d.children;
                                        d.children = null;
                                } else {
                                        d.children = d._children;
                                        d._children = null;
                                }
                                update(d);
                        }

                }


        </script>

</body>


</html>